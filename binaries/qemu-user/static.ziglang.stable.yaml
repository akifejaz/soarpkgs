#!/SBUILD ver @v1.0.0
#SELF: https://raw.githubusercontent.com/pkgforge/soarpkgs/refs/heads/main/binaries/qemu-user/static.ziglang.stable.yaml
_disabled: false

pkg: "qemu-user"
pkg_id: "github.com.ziglang.qemu-static"
pkg_type: "static"
category:
  - "ConsoleOnly"
  - "Utility"
description: #https://www.qemu.org/docs/master/user/main.html#linux-user-space-emulator
  _default: "QEMU user mode Emulation & Virtualization binaries"
  qemu-aarch64: "Simulate a 64-bit Arm machine [qemu-user]"
  qemu-aarch64_be: "Simulate a 64-bit big-endian Arm machine [qemu-user]"
  qemu-alpha: "Simulate a DEC Alpha machine [qemu-user]"
  qemu-arm: "Simulate a 32-bit Arm machine [qemu-user]"
  qemu-armeb: "Simulate a 32-bit big-endian Arm machine [qemu-user]"
  qemu-cris: "Simulate a CRIS (Code Reduced Instruction Set) machine [qemu-user]"
  qemu-hexagon: "Simulate a Qualcomm Hexagon DSP [qemu-user]"
  qemu-hppa: "Simulate a HP PA-RISC machine [qemu-user]"
  qemu-i386: "Simulate a 32-bit x86 machine [qemu-user]"
  qemu-loongarch64: "Simulate a 64-bit LoongArch machine [qemu-user]"
  qemu-m68k: "Simulate a Motorola 68000 series machine [qemu-user]"
  qemu-microblaze: "Simulate a Xilinx MicroBlaze big-endian machine [qemu-user]"
  qemu-microblazeel: "Simulate a Xilinx MicroBlaze little-endian machine [qemu-user]"
  qemu-mips: "Simulate a 32-bit big-endian MIPS machine [qemu-user]"
  qemu-mips64: "Simulate a 64-bit big-endian MIPS machine [qemu-user]"
  qemu-mips64el: "Simulate a 64-bit little-endian MIPS machine [qemu-user]"
  qemu-mipsel: "Simulate a 32-bit little-endian MIPS machine [qemu-user]"
  qemu-mipsn32: "Simulate a 32-bit big-endian MIPS machine with N32 ABI [qemu-user]"
  qemu-mipsn32el: "Simulate a 32-bit little-endian MIPS machine with N32 ABI [qemu-user]"
  qemu-nios2: "Simulate an Altera Nios II machine [qemu-user]"
  qemu-or1k: "Simulate an OpenRISC 1000 machine [qemu-user]"
  qemu-ppc: "Simulate a 32-bit PowerPC machine [qemu-user]"
  qemu-ppc64: "Simulate a 64-bit big-endian PowerPC machine [qemu-user]"
  qemu-ppc64le: "Simulate a 64-bit little-endian PowerPC machine [qemu-user]"
  qemu-riscv32: "Simulate a 32-bit RISC-V machine [qemu-user]"
  qemu-riscv64: "Simulate a 64-bit RISC-V machine [qemu-user]"
  qemu-s390x: "Simulate an IBM System z machine [qemu-user]"
  qemu-sh4: "Simulate a SuperH SH-4 little-endian machine [qemu-user]"
  qemu-sh4eb: "Simulate a SuperH SH-4 big-endian machine [qemu-user]"
  qemu-sparc: "Simulate a 32-bit SPARC machine [qemu-user]"
  qemu-sparc32plus: "Simulate a 32-bit SPARC V8+ machine [qemu-user]"
  qemu-sparc64: "Simulate a 64-bit SPARC machine [qemu-user]"
  qemu-x86_64: "Simulate a 64-bit x86 machine [qemu-user]"
  qemu-xtensa: "Simulate a Tensilica Xtensa little-endian machine [qemu-user]"
  qemu-xtensaeb: "Simulate a Tensilica Xtensa big-endian machine [qemu-user]"
distro_pkg:
  nixpkgs:
    - "qemu-user"
homepage:
  - "https://www.qemu.org"
  - "https://gitlab.com/qemu-project/qemu"
  - "https://github.com/qemu/qemu"
license:
  - id: "GPL-2.0"
    url: "https://gitlab.com/qemu-project/qemu/-/raw/master/COPYING?ref_type=heads"
maintainer:
  - "Azathothas (https://github.com/Azathothas)"
note:
  - "[DO NOT RUN] (Meant for pkgforge CI Only)"
  - "Built From Source using a Community Provided Script. Check/Report @ https://github.com/ziglang/qemu-static"  
provides:
  - "qemu-aarch64==qemu-aarch64-static"
  - "qemu-aarch64_be==qemu-aarch64_be-static"
  - "qemu-alpha==qemu-alpha-static"
  - "qemu-arm==qemu-arm-static"
  - "qemu-armeb==qemu-armeb-static"
  #- "qemu-cris==qemu-cris-static"
  - "qemu-hexagon==qemu-hexagon-static"
  - "qemu-hppa==qemu-hppa-static"
  - "qemu-i386==qemu-i386-static"
  - "qemu-loongarch64==qemu-loongarch64-static"
  - "qemu-m68k==qemu-m68k-static"
  - "qemu-microblaze==qemu-microblaze-static"
  - "qemu-microblazeel==qemu-microblazeel-static"
  - "qemu-mips==qemu-mips-static"
  - "qemu-mips64==qemu-mips64-static"
  - "qemu-mips64el==qemu-mips64el-static"
  - "qemu-mipsel==qemu-mipsel-static"
  - "qemu-mipsn32==qemu-mipsn32-static"
  - "qemu-mipsn32el==qemu-mipsn32el-static"
  #- "qemu-nios2==qemu-nios2-static"
  - "qemu-or1k==qemu-or1k-static"
  - "qemu-ppc==qemu-ppc-static"
  - "qemu-ppc64==qemu-ppc64-static"
  - "qemu-ppc64le==qemu-ppc64le-static"
  - "qemu-riscv32==qemu-riscv32-static"
  - "qemu-riscv64==qemu-riscv64-static"
  - "qemu-s390x==qemu-s390x-static"
  - "qemu-sh4==qemu-sh4-static"
  - "qemu-sh4eb==qemu-sh4eb-static"
  - "qemu-sparc==qemu-sparc-static"
  - "qemu-sparc32plus==qemu-sparc32plus-static"
  - "qemu-sparc64==qemu-sparc64-static"
  - "qemu-x86_64==qemu-x86_64-static"
  - "qemu-xtensa==qemu-xtensa-static"
  - "qemu-xtensaeb==qemu-xtensaeb-static"
repology:
  - "qemu-user"
src_url:
  - "https://github.com/ziglang/qemu-static"
tag:
  - "emulation"
  - "qemu"
  - "virtualization"
x_exec:
  host:
    - "aarch64-Linux"
    - "x86_64-Linux"
  shell: "bash"
  pkgver: |
    curl -qfsSL "https://raw.githubusercontent.com/ziglang/qemu-static/refs/heads/master/command/base" | awk -F'"' '/^QEMU_REV=/ {print $2}' | tr -d '[:space:]'
  run: |
    #Build
     cd "${SBUILD_TMPDIR}" && \
     git clone --filter "blob:none" --quiet "https://github.com/ziglang/qemu-static" "./TEMPREPO" && cd "./TEMPREPO/"
     docker stop "qemu-static" &>/dev/null ; docker rm "qemu-static" &>/dev/null
     docker build --tag "qemu-static" "./" --no-cache && rm -rf "${SBUILD_TMPDIR}/artifact" 2>/dev/null ; mkdir -pv "${SBUILD_TMPDIR}/artifact"
     docker run --privileged --net="host" --name "qemu-builder" "qemu-static" sh -c 'true'
     docker cp "qemu-builder:/work/artifact/." "${SBUILD_TMPDIR}/artifact/."
     docker stop "qemu-builder" &>/dev/null ; docker rm "qemu-builder" &>/dev/null
     docker container rm "qemu-static" 2>/dev/null ; docker image rm "qemu-static" 2>/dev/null
    #Extract
     mkdir -pv "${SBUILD_TMPDIR}/STATIC_BUILD" && \
     find "${SBUILD_TMPDIR}/artifact" -type f -name '*.xz' -exec tar -xvf "{}" --strip-components="1" -C "${SBUILD_TMPDIR}/STATIC_BUILD" \;
    #Copy
     find "${SBUILD_TMPDIR}/STATIC_BUILD" -maxdepth 2 -type f -exec file -i "{}" \; | grep -Ei "application/.*executable|inode/symlink|text/x-perl|text/.*script" | cut -d":" -f1 | xargs realpath --no-symlinks | xargs -I "{}" rsync -achvL "{}" "${SBUILD_OUTDIR}"