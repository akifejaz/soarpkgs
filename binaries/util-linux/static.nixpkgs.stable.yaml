#!/SBUILD ver @v1.0.0
#SELF: https://raw.githubusercontent.com/pkgforge/soarpkgs/refs/heads/main/binaries/util-linux/static.nixpkgs.stable.yaml
_disabled: false

pkg: "util-linux"
pkg_id: "nixpkgs.util-linux"
pkg_type: "static"
category:
  - "ConsoleOnly"
  - "Utility"
description:
  _default: "Collection of Essential & Extended utilities for managing Linux systems"
  addpart: "Tell the kernel about the existence of a specified partition [util-linux]"
  agetty: "Open a tty and prompt for login (acts as an alternative Linux getty) [util-linux]"
  blkdiscard: "Discard the content of sectors on a device [util-linux]"
  blkid: "Print block device information [util-linux]"
  blkpr: "Run persistent reservations command on a device [util-linux]"
  blkzone: "Run zone command on the given block device [util-linux]"
  blockdev: "Call block device ioctls from the command line [util-linux]"
  cal: "Display a calendar, or some part of it [util-linux]"
  cfdisk: "Display or manipulate a disk partition table [util-linux]"
  chcpu: "Configure CPUs in a multi-processor system [util-linux]"
  chfn: "Change finger informaiton [util-linux]"
  chmem: "Set a particular size or range of memory online or offline [util-linux]"
  choom: "Display and adjust OOM-killer score [util-linux]"
  chrt: "Show or change the real-time scheduling attributes of a process [util-linux]"
  chsh: "Change login shell for a user [util-linux]"
  col: "Filter out reverse line feeds from standard input [util-linux]"
  colcrt: "Filter nroff output for CRT previewing [util-linux]"
  colrm: "Filter out the specified columns [util-linux]"
  column: "Columnate lists [util-linux]"
  ctrlaltdel: "Set the function of the Ctrl-Alt-Del combination [util-linux]"
  delpart: "Tell the kernel to forget about a specified partition [util-linux]"
  dmesg: "Print or control the kernel messaging buffer [util-linux]"
  eject: "Eject removable media via software control [util-linux]"
  fadvise: "Utility to use the posix_fadvise system call [util-linux]"
  fallocate: "Preallocate space to, or deallocate space from a file [util-linux]"
  fdisk: "Manipulate partition table [util-linux]"
  fincore: "Count pages of file contents in core [util-linux]"
  findfs: "Find a filesystem by label or UUID [util-linux]"
  findmnt: "Find a (mounted) filesystem: list or search mounted filesystems [util-linux]"
  flock: "Utilize serialization using file locks [util-linux]"
  fsck: "Perform a file system check and repair [util-linux]"
  fsck.cramfs: "Check and repair a compressed ROM filesystem [util-linux]"
  fsck.minix: "Check the consistency of a Minix filesystem [util-linux]"
  fsfreeze: "Suspend access to a filesystem [util-linux]"
  fstrim: "Discard/trim unused blocks on a filesystem [util-linux]"
  getopt: "Parse command options [util-linux]"
  hardlink: "Consolidate duplicate files using hardlinks [util-linux]"
  hexdump: "Display file contents in hexadecimal, decimal, octal, or ASCII [util-linux]"
  hwclock: "Time clocks utility [util-linux]"
  i386: "Change reported architecture to i386 [alias=setarch i386] [util-linux]"
  ionice: "Show or change the I/O-scheduling class and priority of a process [util-linux]"
  ipcmk: "Create various IPC resources [util-linux]"
  ipcrm: "Remove certain IPC resources [util-linux]"
  ipcs: "Show information on IPC facilities [util-linux]"
  irqtop: "Interactive utility to display kernel interrupt information [util-linux]"
  isosize: "Show the length of an ISO-9660 filesystem [util-linux]"
  kill: "Send a signal to a process [util-linux]"
  last: "Show a listing of last logged in users [util-linux]"
  lastb: "Show a listing of all bad login attempts (/var/log/btmp) [util-linux]"
  ldattach: "Attach a line discipline to a serial line [util-linux]"
  linux32: "Change reported architecture to 32bit [util-linux]"
  linux64: "Change reported architecture to 64bit [util-linux]"
  logger: "Enter messages into the system log [util-linux]"
  login: "Begin session on the system [util-linux]"
  look: "Display lines beginning with a specified string [util-linux]"
  losetup: "Control loop devices [util-linux]"
  lsblk: "List information about block devices [util-linux]"
  lscpu: "Display information about the CPU architecture [util-linux]"
  lsfd: "List file descriptors [util-linux]"
  lsipc: "List System V inter-process communication (IPC) resources [util-linux]"
  lsirq: "Utility to display kernel interrupt information [util-linux]"
  lslocks: "List local system locks [util-linux]"
  lslogins: "Display information about known users in the system [util-linux]"
  lsmem: "List the ranges of available memory with their online status [util-linux]"
  lsns: "List system namespaces [util-linux]"
  mcookie: "Generate magic cookies for xauth [util-linux]"
  mesg: "Display (or do not display) messages from other users [util-linux]"
  mkfs: "Make a Linux filesystem [util-linux]"
  mkfs.bfs: "Make an SCO bfs filesystem [util-linux]"
  mkfs.cramfs: "Make cramfs compressed ROM file system [util-linux]"
  mkfs.minix: "Make a Minix filesystem [util-linux]"
  mkswap: "Create a swap area [util-linux]"
  more: "A file perusal filter for CRT viewing [util-linux]"
  mount: "Mount a filesystem [util-linux]"
  mountpoint: "Check whether a directory or file is a mountpoint [util-linux]"
  namei: "Follow a pathname until a terminal point is found [util-linux]"
  nologin: "Politely refuse a login [util-linux]"
  nsenter: "Run a program with namespaces of other processes [util-linux]"
  partx: "Tell the kernel about the presence and numbering of partitions [util-linux]"
  pipesz: "Set/Examine pipe and FIFO buffer sizes [util-linux]"
  pivot_root: "Change the root filesystem [util-linux]"
  prlimit: "Show or change the resource limits of a process [util-linux]"
  readprofile: "Display kernel profiling information [util-linux]"
  rename: "Rename files [util-linux]"
  renice: "Alter the priority of running processes [util-linux]"
  resizepart: "Tell the kernel about the new size of a partition [util-linux]"
  rev: "Reverse lines characterwise [util-linux]"
  rfkill: "Tool for enabling and disabling wireless devices [util-linux]"
  rtcwake: "Enter a system sleep state until a specified wakeup time [util-linux]"
  runuser: "Run <command> with the effective user ID and group ID of <user> [util-linux]"
  script: "Make a typescript of a terminal session [util-linux]"
  scriptlive: "Execute terminal typescript [util-linux]"
  scriptreplay: "Play back terminal typescripts, using timing information [util-linux]"
  setarch: "Change the reported architecture and set personality flags [util-linux]"
  setpriv: "Run a program with different Linux privilege settings [util-linux]"
  setsid: "Run a program in a new session [util-linux]"
  setterm: "Set the attributes of a terminal [util-linux]"
  sfdisk: "Display or manipulate a disk partition table [util-linux]"
  su: "Change user id or become root [util-linux]"
  sulogin: "Single-user login [util-linux]"
  swaplabel: "Display or change the label or UUID of a swap area [util-linux]"
  swapoff: "Disable devices and files for paging and swapping [util-linux]"
  swapon: "Enable devices and files for paging and swapping [util-linux]"
  switch_root: "Switch to another filesystem as the root of the mount tree [util-linux]"
  taskset: "Show or change the CPU affinity of a process [util-linux]"
  uclampset: "Show or change the utilization clamping attributes [util-linux]"
  ul: "Do underlining [util-linux]"
  umount: "Unmount filesystems [util-linux]"
  uname26: "Alter the reported kernel version to appear as 2.6.x [util-linux]"
  unshare: "Run a program with some namespaces unshared from the parent [util-linux]"
  utmpdump: "Dump UTMP and WTMP files in raw format [util-linux]"
  uuidd: "A daemon for generating UUIDs [util-linux]"
  uuidgen: "Create a new UUID value [util-linux]"
  uuidparse: "Parse unique identifiers [util-linux]"
  waitpid: "Wait for arbitrary processes [util-linux]"
  wall: "Write a message to all users [util-linux]"
  wdctl: "Show the status of the hardware watchdog [util-linux]"
  whereis: "Locate the binary, source, and manual-page files for a command [util-linux]"
  wipefs: "Wipe signatures from a device [util-linux]"
  write: "Send a message to another user [util-linux]"
  x86_64: "Change reported architecture to x86_64 [alias=setarch x86_64] [util-linux]"
  zramctl: "Set up and control zram devices [util-linux]"
distro_pkg:
  alpine:
    - "util-linux"
  debian:
    - "util-linux"
  nixpkgs:
    - "util-linux"
homepage:
  - "https://www.kernel.org/pub/linux/utils/util-linux"
  - "https://github.com/util-linux/util-linux"
license:
  - "BSD"  
maintainer:
  - "Azathothas (https://github.com/Azathothas)"
note:
  - "[DO NOT RUN] (Meant for pkgforge CI Only)"
  - "Built Using Nix. Check/Report @ https://github.com/NixOS/nixpkgs"
provides:
  - "addpart"
  - "agetty"
  - "blkdiscard"
  - "blkid"
  - "blkpr"
  - "blkzone"
  - "blockdev"
  - "cal"
  - "cfdisk"
  - "chcpu"
  - "chfn"
  - "chmem"
  - "choom"
  - "chrt"
  - "chsh"
  - "col"
  - "colcrt"
  - "colrm"
  - "column"
  - "ctrlaltdel"
  - "delpart"
  - "dmesg"
  - "eject"
  - "fadvise"
  - "fallocate"
  - "fdisk"
  - "fincore"
  - "findfs"
  - "findmnt"
  - "flock"
  - "fsck"
  - "fsck.cramfs"
  - "fsck.minix"
  - "fsfreeze"
  - "fstrim"
  - "getopt"
  - "hardlink"
  - "hexdump"
  - "hwclock"
  - "i386"
  - "ionice"
  - "ipcmk"
  - "ipcrm"
  - "ipcs"
  - "irqtop"
  - "isosize"
  - "kill"
  - "last"
  - "lastb"
  - "ldattach"
  - "linux32"
  - "linux64"
  - "logger"
  - "login"
  - "look"
  - "losetup"
  - "lsblk"
  - "lscpu"
  - "lsfd"
  - "lsipc"
  - "lsirq"
  - "lslocks"
  - "lslogins"
  - "lsmem"
  - "lsns"
  - "mcookie"
  - "mesg"
  - "mkfs"
  - "mkfs.bfs"
  - "mkfs.cramfs"
  - "mkfs.minix"
  - "mkswap"
  - "more"
  - "mount"
  - "mountpoint"
  - "namei"
  - "nologin"
  - "nsenter"
  - "partx"
  - "pipesz"
  - "pivot_root"
  - "prlimit"
  - "readprofile"
  - "rename"
  - "renice"
  - "resizepart"
  - "rev"
  - "rfkill"
  - "rtcwake"
  - "runuser"
  - "script"
  - "scriptlive"
  - "scriptreplay"
  - "setarch"
  - "setpriv"
  - "setsid"
  - "setterm"
  - "sfdisk"
  - "sulogin"
  - "swaplabel"
  - "swapoff"
  - "swapon"
  - "switch_root"
  - "taskset"
  - "uclampset"
  - "ul"
  - "umount"
  - "uname26"
  - "unshare"
  - "utmpdump"
  - "uuidd"
  - "uuidgen"
  - "uuidparse"
  - "waitpid"
  - "wall"
  - "wdctl"
  - "whereis"
  - "wipefs"
  - "write"
  - "x86_64"
  - "zramctl"  
repology:
  - "util-linux"
src_url:
  - "https://github.com/util-linux/util-linux"
tag:
  - "unixtools"
x_exec:
  host:
    - "aarch64-Linux"
    - "x86_64-Linux"
  shell: "bash"
  pkgver: |
    nix derivation show "nixpkgs#util-linux" --impure --refresh --quiet 1>&1 2>/dev/null | sed -n '/^[[:space:]]*{/,$p' | jq -r '.. | objects | (select(has("version")).version, (select(has("env")) | select(.env.__json != null) | .env.__json | fromjson | select(has("version")).version) | select(.))' | tr -d '"'\''[:space:]'
  run: |
    #Build
     echo -e "\n" ; nix-instantiate --eval --expr "builtins.toJSON (with import <nixpkgs> {}; ${PKG}.meta)" --quiet 2>/dev/null | jq -r fromjson 2>/dev/null ; echo -e "\n"
     nix-build '<nixpkgs>' --impure --attr "pkgsStatic.util-linux" --cores "$(($(nproc)+1))" --max-jobs "$(($(nproc)+1))" --log-format bar-with-logs --out-link "${SBUILD_TMPDIR}/nixbuild"
     find -L "$(find "${SBUILD_TMPDIR}" -maxdepth 1 -type d -o -type l -exec realpath "{}" \; | grep -Ev '^\.$' | head -n 1)" | sort | awk -F/ '{indent=""; for (i=2; i<NF; i++) indent=indent " "; print (NF>1 ? indent "--> " $NF : $NF)}'
    #Fix Perms
     find "${SBUILD_TMPDIR}" -maxdepth 1 -type d -o -type l -exec realpath "{}" \; | grep -Ev '^\.$' |\
     xargs -I{} find -L "{}" -type d -iregex ".*\(bin\|exec\).*" | \
     xargs -I{} sudo rsync -achLv --no-relative "{}/." "${SBUILD_TMPDIR}/."
     sudo chown -Rv "$(whoami):$(whoami)" "${SBUILD_TMPDIR}" && chmod -Rv 755 "${SBUILD_TMPDIR}"
    #Fix Shell Scripts
     find "${SBUILD_TMPDIR}" -type f -iregex '.*\.\(bin\|pl\)$' -exec bash -c 'mv -fv "$1" "${1%.*}"' _ "{}" \;
     find "${SBUILD_TMPDIR}" -type f \( -name "*.sh" -o -exec sh -c 'file -i "$1" | grep -qiv "application/.*executable"' sh {} \; \) -print0 | xargs -0 -I {} sh -c '
           sed "s|^#!/nix/store/.*/bin/sh|#!/bin/sh|" -i "{}" 2>/dev/null
           sed "s|/nix/store[^ ]*/bin/\([^ ]*\)|/usr/local/bin/\1|g" -i "{}" 2>/dev/null
           sed "s|/nix/store/[^/]*/bin|/usr/local/bin|g" -i "{}" 2>/dev/null
           sed "s|/nix/store[^/ ]*/bin|/usr/local/bin|g" -i "{}" 2>/dev/null
           sed "s|/nix/store[^ \"'\'']*|/|g" -i "{}" 2>/dev/null
       '
    #Copy
     find "${SBUILD_TMPDIR}" -maxdepth 1 -type f -exec file -i "{}" \; | grep -Ei 'application/.*executable|text/x-perl|text/.*script' | cut -d":" -f1 | xargs realpath | sort -u | xargs -I "{}" rsync -achvL "{}" "${SBUILD_OUTDIR}"
     ( askalono --format "json" crawl --follow "${SBUILD_TMPDIR}" | jq -r ".. | objects | .path? // empty" | head -n 1 | xargs -I "{}" cp -fv "{}" "${SBUILD_OUTDIR}/LICENSE" ) 2>/dev/null 